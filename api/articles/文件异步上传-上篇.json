{"title":"文件异步上传-上篇","uid":"4b0289e2cf3d1d421c26226791ccfc96","slug":"文件异步上传-上篇","date":"2016-05-12T08:43:36.000Z","updated":"2021-04-06T12:17:14.938Z","comments":true,"path":"api/articles/文件异步上传-上篇.json","cover":"https://heaven-blog-1255884785.file.myqcloud.com/poster-thumbnail.jpg","content":"<h3 id=\"项目背景\"><a href=\"#项目背景\" class=\"headerlink\" title=\"项目背景\"></a>项目背景</h3><p>在这篇文章的里面和大家分享下 HTML5 的文件上传操作，后台是我用 <code>nodejs</code> 的<code>koa</code>框架搭建的一个Demo，所在在这篇文章里面，我也会顺带讲讲如何用<code>koa</code>搭建一个简单的node后台。</p>\n<h3 id=\"技术要点\"><a href=\"#技术要点\" class=\"headerlink\" title=\"技术要点\"></a>技术要点</h3><ol>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader\">FileReader</a> 用来实现图片预览、<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/FormData\">FormData</a> 用来实现文件异步上传操作</li>\n<li>koa 框架的简单使用</li>\n<li>利用 FormData 实现文件异步上传操作</li>\n</ol>\n<span id=\"more\"></span>\n<h3 id=\"前端主要代码\"><a href=\"#前端主要代码\" class=\"headerlink\" title=\"前端主要代码\"></a>前端主要代码</h3><h4 id=\"图片预览\"><a href=\"#图片预览\" class=\"headerlink\" title=\"图片预览\"></a>图片预览</h4><p>原理：利用<code>FileReader</code>对象的<code>readAsDataURL</code>方法，我们可以得到一个图片文件的<code>base64</code>位的编码格式，然后讲得到的数据赋值给<code>img</code>对象的<code>src</code>属性，就能实现预览操作了，其中的<code>base64</code>数据通过<code>FileReader</code>的实例对象的<code>onload</code>之后得到的<code>event.target.result</code>就是我们需要的数据了。</p>\n<p>图片文佳不宜过大，不然转成<code>base64</code>之后数据量太大，前端可以做适当的约束。通过原生<code>Dom</code>的<code>files</code>属性，我们可以得到用户选择的文件列表，是一个数组形式。通过<code>file.type</code>、<code>file.size</code>分别可以得到文件类型和文件的大小。</p>\n<p><em>注意：监听<code>reader</code>的<code>load</code>事件需要在<code>reader.readAsDataURL()</code>之前</em></p>\n<p>主要代码如下：</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 监听文件域的 'change' 事件</span>\n$fileChooses<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'.input-file'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">var</span> $<span class=\"token keyword\">this</span> <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> $fileChoose <span class=\"token operator\">=</span> $<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">closest</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.file-choose'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> $thumb <span class=\"token operator\">=</span> $<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">siblings</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.thumb'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// HTML5 FileReader 对象</span>\n    <span class=\"token keyword\">var</span> reader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileReader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> file <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// inject an image with the src url</span>\n    reader<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        $thumb<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">'src'</span><span class=\"token punctuation\">,</span> event<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        $fileChoose<span class=\"token punctuation\">.</span><span class=\"token function\">addClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'file-choose-loaded'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        count<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>count <span class=\"token operator\">==</span> $fileChooses<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n            $submit<span class=\"token punctuation\">.</span><span class=\"token function\">removeClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'disabled'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 过滤图片文件</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>file<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token string\">'image.*'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'请选择图片类型文件'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        $submit<span class=\"token punctuation\">.</span><span class=\"token function\">addClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'disabled'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token comment\">// 判断文件大小，限制小于 1MB</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span>size <span class=\"token operator\">></span> <span class=\"token number\">1024</span> <span class=\"token operator\">*</span> <span class=\"token number\">1024</span> <span class=\"token operator\">*</span> <span class=\"token number\">1024</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'上传文件不能大于 1MB 或者 1024kb'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        $submit<span class=\"token punctuation\">.</span><span class=\"token function\">addClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'disabled'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token comment\">// 读取文件预览</span>\n    reader<span class=\"token punctuation\">.</span><span class=\"token function\">readAsDataURL</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"清除图片预览\"><a href=\"#清除图片预览\" class=\"headerlink\" title=\"清除图片预览\"></a>清除图片预览</h4><p>看代码：</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 关闭按钮</span>\n$fileChooses<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'.icon-delete'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n  <span class=\"token comment\">// 清除 .loaded 类，清空 .thumb 的src</span>\n  <span class=\"token keyword\">var</span> $<span class=\"token keyword\">this</span> <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      $fileChoose <span class=\"token operator\">=</span> $<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">closest</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.file-choose'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      $file <span class=\"token operator\">=</span> $<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">siblings</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.input-file'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      $thumb <span class=\"token operator\">=</span> $<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">siblings</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.thumb'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  $fileChoose<span class=\"token punctuation\">.</span><span class=\"token function\">removeClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'file-choose-loaded'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  $submit<span class=\"token punctuation\">.</span><span class=\"token function\">addClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'disabled'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// 清除预览数据</span>\n  $thumb<span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">'src'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  count<span class=\"token operator\">--</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// 这是可能出现兼容性问题，如果不将这里清空，</span>\n  <span class=\"token comment\">// 下一次选择图片如果选择相同的将无法触发 change 事件</span>\n  $file<span class=\"token punctuation\">.</span><span class=\"token function\">val</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"核心部分，文件上传\"><a href=\"#核心部分，文件上传\" class=\"headerlink\" title=\"核心部分，文件上传\"></a>核心部分，文件上传</h4><p>使用<code>FormData</code>有两种方式，一种是直接通过<code>FormData.append()</code>方法添加文件域，另外一种是直接使用现有的<code>form</code>表单当做构造参数实例化一个<code>FormData</code>对象</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">$submit<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n    <span class=\"token comment\">// 方式1：用 formData 的形式提交</span>\n    <span class=\"token keyword\">var</span> formData <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FormData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    formData<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">'uploadify1'</span><span class=\"token punctuation\">,</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.input-file'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    formData<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">'uploadify2'</span><span class=\"token punctuation\">,</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.input-file'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 方式二：表单序列化</span>\n    <span class=\"token comment\">// var formData = new FormData($form[0]);</span>\n\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasClass</span><span class=\"token punctuation\">(</span><span class=\"token string\">'disabled'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>ajaxStatus<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n    ajaxStatus <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n\n\n    <span class=\"token comment\">// 表单提交</span>\n    $<span class=\"token punctuation\">.</span><span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>\n        url<span class=\"token operator\">:</span> <span class=\"token string\">'/upload'</span><span class=\"token punctuation\">,</span>\n        type<span class=\"token operator\">:</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">,</span>\n        dataType<span class=\"token operator\">:</span> <span class=\"token string\">'json'</span><span class=\"token punctuation\">,</span>\n        data<span class=\"token operator\">:</span> formData<span class=\"token punctuation\">,</span>\n        <span class=\"token comment\">// 这两项必填，作为文件上传的时候</span>\n        contentType<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n        processData<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resp</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>resp<span class=\"token punctuation\">.</span>status <span class=\"token operator\">==</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n            <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">'上传成功'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"success\"</span><span class=\"token punctuation\">,</span> resp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"error\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">always</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        ajaxStatus <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"complete\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>源码地址：<a href=\"https://github.com/lichenbuliren/html5-file-upload\">https://github.com/lichenbuliren/html5-file-upload</a></p>\n<h3 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h3><p>到这里前端的基本代码都介绍完了，在下一章里面将会介绍和后端配合来实现文件的保存与请求响应操作。</p>\n","feature":null,"text":"项目背景在这篇文章的里面和大家分享下 HTML5 的文件上传操作，后台是我用 nodejs 的koa框架搭建的一个Demo，所在在这篇文章里面，我也会顺带讲讲如何用koa搭建一个简单的node后台。 技术要点 FileReader 用来实现图片预览、FormData 用来实现文件...","link":"","photos":[],"count_time":{"symbolsCount":"3.2k","symbolsTime":"3 mins."},"categories":[{"name":"JavaScript","slug":"JavaScript","count":7,"path":"api/categories/JavaScript.json"},{"name":"nodejs","slug":"JavaScript/nodejs","count":2,"path":"api/categories/JavaScript/nodejs.json"}],"tags":[{"name":"HTML5","slug":"HTML5","count":2,"path":"api/tags/HTML5.json"},{"name":"File Upload","slug":"File-Upload","count":2,"path":"api/tags/File-Upload.json"},{"name":"ajax","slug":"ajax","count":2,"path":"api/tags/ajax.json"},{"name":"nodejs","slug":"nodejs","count":2,"path":"api/tags/nodejs.json"},{"name":"koa","slug":"koa","count":2,"path":"api/tags/koa.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%A1%B9%E7%9B%AE%E8%83%8C%E6%99%AF\"><span class=\"toc-text\">项目背景</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%8A%80%E6%9C%AF%E8%A6%81%E7%82%B9\"><span class=\"toc-text\">技术要点</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%89%8D%E7%AB%AF%E4%B8%BB%E8%A6%81%E4%BB%A3%E7%A0%81\"><span class=\"toc-text\">前端主要代码</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%9B%BE%E7%89%87%E9%A2%84%E8%A7%88\"><span class=\"toc-text\">图片预览</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%B8%85%E9%99%A4%E5%9B%BE%E7%89%87%E9%A2%84%E8%A7%88\"><span class=\"toc-text\">清除图片预览</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%A0%B8%E5%BF%83%E9%83%A8%E5%88%86%EF%BC%8C%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0\"><span class=\"toc-text\">核心部分，文件上传</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%B0%8F%E7%BB%93\"><span class=\"toc-text\">小结</span></a></li></ol>","author":{"name":"Heaven","avatar":"https://heaven-blog-1255884785.file.myqcloud.com/github-avatar.jpeg","link":""},"mapped":true,"prev_post":{"title":"文件异步上传-下篇","uid":"7092c4b01069ea099d8288e295900109","slug":"文件异步上传-下篇","date":"2016-05-17T06:43:07.000Z","updated":"2021-04-06T12:17:17.109Z","comments":true,"path":"api/articles/文件异步上传-下篇.json","cover":"https://heaven-blog-1255884785.file.myqcloud.com/poster-thumbnail.jpg","text":"写在前面上一篇主要讲了文件异步上传的前端相关的东西，在这篇文章里面，我们主要讲解写使用koa框架来搭建一个简单的处理文件上传的node后台项目。 在这里我不会仔细的讲解每个模块中间件的具体使用方法，文章中提到的模块我都会给出链接，有需要的可以自己去看官方的API学习。 主要功能模...","link":"","photos":[],"count_time":{"symbolsCount":"2.8k","symbolsTime":"3 mins."},"categories":[{"name":"JavaScript","slug":"JavaScript","count":7,"path":"api/categories/JavaScript.json"},{"name":"nodejs","slug":"JavaScript/nodejs","count":2,"path":"api/categories/JavaScript/nodejs.json"}],"tags":[{"name":"HTML5","slug":"HTML5","count":2,"path":"api/tags/HTML5.json"},{"name":"File Upload","slug":"File-Upload","count":2,"path":"api/tags/File-Upload.json"},{"name":"ajax","slug":"ajax","count":2,"path":"api/tags/ajax.json"},{"name":"nodejs","slug":"nodejs","count":2,"path":"api/tags/nodejs.json"},{"name":"koa","slug":"koa","count":2,"path":"api/tags/koa.json"}],"author":{"name":"Heaven","avatar":"https://heaven-blog-1255884785.file.myqcloud.com/github-avatar.jpeg","link":""}},"next_post":{"title":"React 入门实践小结","uid":"897aedbfe64dbcfa0eb404fcd13bbcd3","slug":"React-入门实践小结","date":"2015-12-04T11:59:16.000Z","updated":"2021-04-06T12:16:16.932Z","comments":true,"path":"api/articles/React-入门实践小结.json","cover":"https://heaven-blog-1255884785.file.myqcloud.com/poster-thumbnail.jpg","text":"React 入门练习实践总结 1、模板使用&lt;!DOCTYPE html> &lt;html lang=\"en\"> &lt;head> &lt;meta charset=\"UTF-8\"> &lt;script src=\"../lib/react.js\">&lt;/script...","link":"","photos":[],"count_time":{"symbolsCount":"8.2k","symbolsTime":"7 mins."},"categories":[{"name":"React","slug":"React","count":2,"path":"api/categories/React.json"}],"tags":[{"name":"javascript","slug":"javascript","count":4,"path":"api/tags/javascript.json"},{"name":"react","slug":"react","count":3,"path":"api/tags/react.json"}],"author":{"name":"Heaven","avatar":"https://heaven-blog-1255884785.file.myqcloud.com/github-avatar.jpeg","link":""}}}